<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      Portal do CIEGES ‚Äì Centro Integrado de Estrat√©gia e Gest√£o em Sa√∫de
    </title>
    <meta
      name="description"
      content="Portal do CIEGES ‚Äì Centro Integrado de Estrat√©gia e Gest√£o em Sa√∫de do Esp√≠rito Santo."
    />
    <meta
      name="keywords"
      content="sa√∫de, Esp√≠rito Santo, painel, informa√ß√µes, plataformas, institucional, pain√©is de sa√∫de"
    />
    <meta
      name="author"
      content="SESA - Secretaria de Estado de Sa√∫de do Esp√≠rito Santo"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans&display=swap"
      rel="stylesheet"
    />
    <link
      rel="shortcut icon"
      href="https://cdn.es.gov.br/images/favicons/governo/favicon.ico"
    />

    <style>
      @import url("https://fonts.googleapis.com/css2?family=Noto+Sans:ital,wght@0,100..900;1,100..900&family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap");

      :root {
        --primary-color: #208baa;
        --secondary-color: #0080a5;
        --text-color: #00626f;
        --hover-bg: #e2e8f0;
        --dark-hover-bg: #4a5568;
      }

      body {
        font-family: "Noto Sans", sans-serif;
        font-optical-sizing: auto;
        font-style: normal;
        font-variation-settings: 100;
        background-color: #ffffff;
        scroll-behavior: smooth;
        box-sizing: border-box;
        overflow-x: hidden;
      }

      .text-custom-black {
        color: var(--text-color);
      }

      .text-custom-white {
        color: #fff;
      }

      .rounded-xl {
        border-radius: 0.75rem;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: scale(0.95);
        }

        to {
          opacity: 1;
          transform: scale(1);
        }
      }

      .animate-fade-in {
        animation: fadeIn 0.3s ease-out forwards;
      }

      .contraste a {
        color: #ff0 !important;
      }

      .contraste button {
        background-color: #ff0 !important;
        color: #000 !important;
      }

      .contraste input,
      .contraste select {
        background-color: #fff !important;
        color: #000 !important;
      }

      .contraste footer {
        background-color: #000 !important;
        color: #fff !important;
      }

      .sidebar {
        width: 64px;
        transition: width 0.3s ease-in-out;
      }

      .sidebar.expanded {
        width: 256px;
      }

      .main-content {
        margin-left: 64px;
        transition: margin-left 0.3s ease-in-out;
      }

      .main-content.expanded {
        margin-left: 256px;
      }

      .sidebar:not(.expanded) .sidebar-text {
        display: none;
      }

      .sidebar:not(.expanded) .sidebar-link img {
        margin-right: 0;
      }

      @media (min-width: 1024px) {
        .sidebar-toggle-button {
          display: none;
        }

        .sidebar {
          width: 256px;
        }

        .main-content {
          margin-left: 256px;
        }

        .sidebar-text {
          display: inline;
        }

        .sidebar-link img {
          margin-right: 0.75rem;
        }
      }

      @media (max-width: 768px) {
        .header-logo {
          height: 3rem;
        }

        .header-title {
          font-size: 1.25rem;
        }

        .sidebar {
          top: 5rem;
        }

        .main-content {
          padding-top: 5rem;
        }
      }

      @media (max-width: 480px) {
        .header-logo {
          height: 2.5rem;
        }

        .header-title {
          font-size: 1rem;
        }

        .sidebar {
          top: 4rem;
        }

        .main-content {
          padding-top: 4rem;
        }
      }

      .floating-menu {
        position: fixed;
        background: white;
        border: 1px solid #e2e8f0;
        border-radius: 0.5rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        padding: 0.5rem;
        z-index: 50;
        top: calc(100% + 0.5rem);
        left: 50%;
        transform: translateX(-50%);
        min-width: 200px;
        display: flex;
        flex-direction: column;
      }

      .floating-menu a {
        display: block;
        padding: 0.5rem 0.75rem;
        text-align: left;
        white-space: nowrap;
        color: #0c5e35;
      }
    </style>
  </head>

  <body class="flex flex-col min-h-screen">
    <button
      id="openPopup"
      class="fixed bottom-6 right-6 bg-[var(--primary-color)] hover:bg-[#187591] text-white px-4 py-2 rounded-full shadow-lg transition z-50"
    >
      ‚≠ê Mais acessados !
    </button>

    <div
      id="popupModal"
      class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center hidden z-50"
    >
      <div
        class="bg-white w-full max-w-md p-6 rounded-lg shadow-xl relative animate-fade-in"
      >
        <button
          id="closePopup"
          class="absolute top-2 right-3 text-gray-500 text-xl font-bold hover:text-red-500"
        >
          &times;
        </button>
        <h2
          class="text-lg font-light text-[var(--secondary-color)] mb-4 text-center"
        >
          Pain√©is Mais Acessados
        </h2>
        <ul id="mostAccessedList" class="space-y-2 text-sm text-gray-700"></ul>
      </div>
    </div>

    <div class="w-full h-full">
      <svg viewBox="10 0 1290 200" class="w-full h-full">
        <defs>
          <linearGradient id="gradES" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop
              offset="0%"
              style="stop-color: var(--primary-color); stop-opacity: 1"
            />
            <stop offset="50%" style="stop-color: #ffffff; stop-opacity: 1" />
            <stop
              offset="100%"
              style="stop-color: var(--secondary-color); stop-opacity: 1"
            />
          </linearGradient>
        </defs>
        <path
          fill="url(#gradES)"
          d="M0,160 L48,165.3 C96,171 192,181 288,165.3 C384,149 480,107 576,96 C672,85 768,107 864,117.3 C960,128 1056,128 1152,138.65 C1248,149 1344,171 1392,181.3 L1440,192 L1440,0 L1392,0 L1344,0 L1248,0 L1152,0 L1056,0 L960,0 L864,0 L768,0 L672,0 L576,0 L480,0 L384,0 L288,0 L192,0 L96,0 L48,0 L0,0 Z"
        >
          <animate
            attributeName="d"
            dur="6s"
            repeatCount="indefinite"
            values="M0,80L48,86.5C96,93,192,106,288,90C384,74,480,32,576,24C672,16,768,32,864,42C960,54,1056,54,1152,64C1248,74,1344,96,1392,106L1440,120V0H0Z;
              M0,64L48,69.3C96,75,192,85,288,70C384,53,480,11,576,4C672,-2,768,12,864,22C960,34,1056,34,1152,45C1248,56,1344,77,1392,88L1440,96V0H0Z;
              M0,80L48,86.5C96,93,192,106,288,90C384,74,480,32,576,24C672,16,768,32,864,42C960,54,1056,54,1152,64C1248,74,1344,96,1392,106L1440,120V0H0Z"
          />
        </path>
      </svg>
    </div>

    <header
      class="fixed top-0 left-0 w-full bg-white shadow-md z-40 flex items-center justify-between px-4 h-20 md:h-24"
    >
      <!-- Bot√£o menu (mobile apenas) -->
      <button
        id="menuToggle"
        class="lg:hidden text-gray-700 hover:text-gray-900 focus:outline-none"
      >
        <svg
          class="w-6 h-6"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 6h16M4 12h16m-7 6h7"
          ></path>
        </svg>
      </button>

      <h1
        class="flex-1 text-center text-lg md:text-2xl font-extrabold bg-gradient-to-r from-[#73b6ca] to-pink-600 text-transparent bg-clip-text drop-shadow px-2 leading-tight"
      >
        CIEGES ‚Äì Centro Integrado de
        <br class="block md:hidden" />
        Estrat√©gia e Gest√£o em Sa√∫de
      </h1>
    </header>

    <aside
      id="sidebar"
      class="fixed top-20 md:top-24 left-0 h-[calc(100%-80px)] md:h-[calc(100%-96px)] bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-200 sidebar z-30 transition-all duration-300 ease-in-out overflow-y-auto"
    >
      <nav class="mt-4">
        <a
          href="#"
          id="dashboardLink"
          class="flex items-center p-4 hover:bg-[var(--hover-bg)] dark:hover:bg-[var(--dark-hover-bg)] transition-colors duration-200 sidebar-link"
        >
          <img src="saude-dashboard.png" alt="Dashboard" class="h-6 w-6 mr-3" />
          <span class="sidebar-text">Pain√©is</span>
        </a>
      </nav>
      <button
        id="publicToggle"
        class="flex w-full items-center p-4 text-left hover:bg-[var(--hover-bg)] transition font-semibold"
      >
        <span class="sidebar-text flex-1">üìä Pain√©is P√∫blicos</span>
        <svg
          id="chevron"
          class="h-4 w-4 transition"
          viewBox="0 0 20 20"
          fill="currentColor"
        >
          <path
            fill-rule="evenodd"
            d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.24a.75.75 0 01-1.06 0L5.21 8.29a.75.75 0 01.02-1.08z"
            clip-rule="evenodd"
          />
        </svg>
      </button>

      <div id="publicSubmenu" class="ml-4 hidden flex-col space-y-1">
        <a
          href="https://observatorio-saude.vercel.app/observatorio.html"
          target="_blank"
          class="flex items-center p-3 hover:bg-[var(--hover-bg)] transition sidebar-link"
        >
          <img
            src="observatorio.png"
            alt="Observat√≥rio de Sa√∫de"
            class="h-5 w-5 mr-3"
          />
          <span class="sidebar-text">Observat√≥rio de Sa√∫de</span>
        </a>


        <a
          href="https://sesa.viya.saude.es.gov.br/SASVisualAnalytics/?reportUri=%2Freports%2Freports%2Fd7bb7c2b-28c9-42bf-8818-28ac9f084230&sectionIndex=0&sso_guest=true&reportViewOnly=true&reportContextBar=false&sas-welcome=false"
          target="_blank"
          class="flex items-center p-3 hover:bg-[var(--hover-bg)] transition sidebar-link"
        >
          <img
            src="transparencia.png"
            alt="Transpar√™ncia Consultas e Exames"
            class="h-5 w-5 mr-3"
          />
          <span class="sidebar-text"
            >Painel Transpar√™ncia para Consultas e Exames</span
          >
        </a>

        <a
          href="https://app.wiki.saude.es.gov.br/pt-br/vigilanciasaude/sistema-de-informacao-e-dados/paineis"
          target="_blank"
          class="flex items-center p-3 hover:bg-[var(--hover-bg)] transition sidebar-link"
        >
          <img
            src="vigilancia.png"
            alt="Vigil√¢ncia em Sa√∫de"
            class="h-5 w-5 mr-3"
          />
          <span class="sidebar-text">Vigil√¢ncia em Sa√∫de</span>
        </a>
      </div>

      <div
        class="mx-3 my-6 p-4 bg-white rounded-lg shadow border-l-4 border-[var(--primary-color)]"
      >
        <h3 class="text-sm font-bold leading-tight mb-2">
          <span class="px-1">Acesso aos pain√©is</span><br />
          <span class="px-1">do CIEGES</span>
        </h3>

        <hr class="my-3 border-gray-300" />

        <p class="text-xs mb-4">
          Est√° <strong>sem acesso</strong><br />
          aos Pain√©is Anal√≠ticos?
        </p>
        <p class="text-xs mb-6">
          Preencha o formul√°rio<br />e justifique seu acesso.
        </p>

        <a
          href="https://treinamento.e-flow.es.gov.br/flow-definition/933cd358-74d3-41f7-f754-e5a86c1d2830?d=1"
          target="_blank"
          class="flex items-center justify-center gap-2 bg-[var(--primary-color)] hover:bg-[#187591] text-white font-semibold py-2 rounded-md text-xs"
        >
          <svg class="h-4 w-4 fill-current" viewBox="0 0 24 24">
            <path
              d="M12 1a5 5 0 00-5 5v3H6a2 2 0 00-2 2v9a2 2 0 002 2h12a2 2 0 002-2v-9a2 2 0 00-2-2h-1V6a5 5 0 00-5-5zm-3 5a3 3 0 016 0v3H9V6zm9 5v9H6v-9h12z"
            />
          </svg>
          Solicitar acesso
        </a>
      </div>
    </aside>
    <main
      id="mainContent"
      class="main-content flex-1 pt-0 md:pt- p-3 transition-all duration-300 ease-in-out"
    >
      <div class="max-w-8xl mx-auto">
        <div
          id="cardContainer"
          class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-5 gap-9 justify-items-center"
        ></div>
        <div id="moduleContentArea" class="hidden"></div>
      </div>
    </main>

    <footer
      class="w-full bg-gray-200 py-4 text-xs text-gray-700 border-t mt-auto"
    >
      <div
        class="max-w-6xl mx-auto flex flex-col items-center gap-3 sm:flex-row sm:justify-center sm:gap-6"
      >
        <img
          src="Brasao_Governo.png"
          alt="Governo do Esp√≠rito Santo"
          class="h-10 sm:h-12"
        />

        <div class="text-center sm:text-left">
          <p class="font-semibold">
            SESA ‚Äì Secretaria de Estado de Sa√∫de do Esp√≠rito Santo
          </p>
          <p>N√∫cleo de Desenvolvimento de Sistemas ‚Äì NEDTI | SESA‚ÄëES</p>
          <p class="mt-1">
            &copy; <span id="currentYear"></span> Governo do Estado do Esp√≠rito
            Santo
          </p>
        </div>
      </div>
    </footer>

    <div
      id="modal"
      class="fixed inset-0 bg-black bg-opacity-40 hidden items-center justify-center z-50"
    >
      <div
        class="bg-white w-full max-w-md p-6 rounded-lg shadow-xl relative flex flex-col"
      >
        <button
          onclick="fecharModal()"
          class="absolute top-2 right-3 text-[var(--primary-color)] text-xl hover:text-red-600"
        >
          &times;
        </button>
        <h2
          id="modalTitle"
          class="text-lg font-bold mb-2 text-[var(--primary-color)]"
        ></h2>
        <div id="modalContent" class="text-sm text-gray-700"></div>
      </div>
    </div>
  </body>
  <script>
    document.getElementById("currentYear").innerText = new Date().getFullYear();

    const cardsData = [
      {
        id: "regulacaoAmbulatorial",
        title: "Regula√ß√£o Ambulatorial",
        image: "ambulatorial.png",
        category: "Regula√ß√£o",
        tags: ["cidad√£o", "servi√ßos"],
        popup: true,
        popupContent: `
              <a href="https://sesa.viya.saude.es.gov.br/regamb-absenteismo"                target="_blank" class="block hover:bg-gray-100 px-3 py-2 text-sm">Absente√≠smo</a>
              <a href="https://sesa.viya.saude.es.gov.br/regamb-gestao-clinica"            target="_blank" class="block hover:bg-gray-100 px-3 py-2 text-sm">Gest√£o Cl√≠nica</a>
              <a href="https://sesa.viya.saude.es.gov.br/regamb-gestao-acesso"             target="_blank" class="block hover:bg-gray-100 px-3 py-2 text-sm">Gest√£o de Acesso</a>
              <a href="https://sesa.viya.saude.es.gov.br/regamb-gestao-filas"              target="_blank" class="block hover:bg-gray-100 px-3 py-2 text-sm">Gest√£o de Filas</a>
              <a href="https://sesa.viya.saude.es.gov.br/regamb-gestao-oferta"             target="_blank" class="block hover:bg-gray-100 px-3 py-2 text-sm">Gest√£o de Oferta</a>
              <a href="https://sesa.viya.saude.es.gov.br/regamb-opiniao-formativa"         target="_blank" class="block hover:bg-gray-100 px-3 py-2 text-sm">Opini√£o Formativa</a>
              <a href="https://sesa.viya.saude.es.gov.br/regamb-logistica-atendimento-medico" target="_blank" class="block hover:bg-gray-100 px-3 py-2 text-sm">Dist√¢ncia & Log√≠stica de Atendimento</a>
              <a href="https://sesa.viya.saude.es.gov.br/regamb-gestao-enunciado-cnj93"    target="_blank" class="block hover:bg-gray-100 px-3 py-2 text-sm">Gest√£o Enunciado CNJ 93</a>
            `,
        moduleContent: `
              <h2 class="text-2xl font-bold mb-4">Regula√ß√£o Ambulatorial</h2>
              <p>Pain√©is e indicadores para a gest√£o ambulatorial.</p>
              <div class="mt-4 border p-4 rounded-md bg-gray-50 space-y-1">
                <a href="https://sesa.viya.saude.es.gov.br/regamb-absenteismo"                target="_blank" class="block hover:underline text-[var(--text-color)]">Absente√≠smo</a>
                <a href="https://sesa.viya.saude.es.gov.br/regamb-gestao-clinica"            target="_blank" class="block hover:underline text-[var(--text-color)]">Gest√£o Cl√≠nica</a>
                <a href="https://sesa.viya.saude.es.gov.br/regamb-gestao-acesso"             target="_blank" class="block hover:underline text-[var(--text-color)]">Gest√£o de Acesso</a>
                <a href="https://sesa.viya.saude.es.gov.br/regamb-gestao-filas"              target="_blank" class="block hover:underline text-[var(--text-color)]">Gest√£o de Filas</a>
                <a href="https://sesa.viya.saude.es.gov.br/regamb-gestao-oferta"             target="_blank" class="block hover:underline text-[var(--text-color)]">Gest√£o de Oferta</a>
                <a href="https://sesa.viya.saude.es.gov.br/regamb-opiniao-formativa"         target="_blank" class="block hover:underline text-[var(--text-color)]">Opini√£o Formativa</a>
                <a href="https://sesa.viya.saude.es.gov.br/regamb-logistica-atendimento-medico" target="_blank" class="block hover:underline text-[var(--text-color)]">Dist√¢ncia & Log√≠stica de Atendimento</a>
                <a href="https://sesa.viya.saude.es.gov.br/regamb-gestao-enunciado-cnj93"    target="_blank" class="block hover:underline text-[var(--text-color)]">Gest√£o Enunciado CNJ 93</a>
              </div>
            `,
      },

      {
        id: "mandadosJudiciais",
        title: "Mandados Judiciais",
        image: "gavel.png",
        tags: ["cidad√£o", "servi√ßos"],
        popup: true,
        popupContent: `
              <a href="https://sesa.viya.saude.es.gov.br/mj-acompanhamento-processos"
                 target="_blank" class="block hover:bg-gray-100 px-3 py-2 text-sm">
                 Acompanhamento de Processos
              </a>
              <a href="https://sesa.viya.saude.es.gov.br/mj-judicializacao-saude"
                 target="_blank" class="block hover:bg-gray-100 px-3 py-2 text-sm">
                 Judicializa√ß√£o da Sa√∫de
              </a>
            `,
        moduleContent: `
              <h2 class="text-2xl font-bold mb-4">Mandados Judiciais</h2>
              <p>Pain√©is sobre processos e judicializa√ß√£o na sa√∫de.</p>
              <div class="mt-4 border p-4 rounded-md bg-gray-50 space-y-1">
                <a href="https://sesa.viya.saude.es.gov.br/mj-acompanhamento-processos"
                   target="_blank" class="block hover:underline text-[var(--text-color)]">
                   Acompanhamento de Processos
                </a>
                <a href="https://sesa.viya.saude.es.gov.br/mj-judicializacao-saude"
                   target="_blank" class="block hover:underline text-[var(--text-color)]">
                   Judicializa√ß√£o da Sa√∫de
                </a>
              </div>
            `,
      },

      {
        id: "recursosHumanos",
        title: "Recursos Humanos",
        image: "recurs.png",
        underConstruction: true,
        tags: ["Institucional"],
        popup: false,
        moduleContent: `
              <h2 class="text-2xl font-bold mb-4">Recursos Humanos</h2>
              <p class="text-center">Painel em constru√ß√£o üöß</p>
            `,
      },
      {
        id: "assistenciaFarmaceutica",
        title: "Assist√™ncia Farmac√™utica",
        image: "farmacia aaa.png",
        underConstruction: true, //  üîß NOVO
        tags: ["cidad√£o", "servi√ßos"],
        popup: false,
        moduleContent: `
              <h2 class="text-2xl font-bold mb-4">Assist√™ncia Farmac√™utica</h2>
              <p class="text-center">Painel em constru√ß√£o üöß</p>
            `,
      },
      {
        id: "contratualizacao",
        title: "Contratualiza√ß√£o",
        image: "fina-h.png",
        underConstruction: true, //  üîß NOVO
        tags: ["Institucional", "dados"],
        popup: false,
        moduleContent: `
              <h2 class="text-2xl font-bold mb-4">Contratualiza√ß√£o</h2>
              <p class="text-center">Painel em constru√ß√£o üöß</p>
            `,
      },
      {
        id: "regulacaoLeitos",
        title: "Regula√ß√£o de Leitos",
        image: "CAMA.jpg",
        underConstruction: true, //  üîß NOVO
        tags: ["cidad√£o", "servi√ßos"],
        popup: false,
        moduleContent: `
              <h2 class="text-2xl font-bold mb-4">Regula√ß√£o de Leitos</h2>
              <p class="text-center">Painel em constru√ß√£o üöß</p>
            `,
      },

      {
        id: "atencaoPrimaria",
        title: "Aten√ß√£o Prim√°ria",
        image: "atencao-primaria.png",
        tags: ["cidad√£o", "servi√ßos"],
        underConstruction: true, //  üîß NOVO
        popup: false,
        moduleContent: `
            <h2 class="text-2xl font-bold mb-4">Aten√ß√£o Prim√°ria</h2>
              <p class="text-center">Painel em constru√ß√£o üöß</p>
        `,
      },
    ];

    const container = document.getElementById("cardContainer");
    const moduleContentArea = document.getElementById("moduleContentArea");
    const sidebar = document.getElementById("sidebar");
    const mainContent = document.getElementById("mainContent");
    const menuToggle = document.getElementById("menuToggle");
    const dashboardLink = document.getElementById("dashboardLink");

    let activeCategory = "Todos";
    let searchTerm = "";

    function renderCards() {
      container.innerHTML = "";

      const filtered = cardsData.filter((card) => {
        const matchCategory =
          activeCategory === "Todos" || card.category === activeCategory;
        const matchText =
          card.title.toLowerCase().includes(searchTerm) ||
          (card.description &&
            card.description.toLowerCase().includes(searchTerm));
        return matchCategory && matchText;
      });

      if (!filtered.length) {
        container.innerHTML = `<p class="col-span-full text-center text-gray-500">
                Nenhuma plataforma encontrada.</p>`;
      }

      filtered.forEach((card) => {
        const el = document.createElement("div");
        el.setAttribute("data-id", card.id);
        el.className =
          "w-full max-w-[220px] h-full bg-white rounded-xl shadow-md p-4 flex flex-col items-center justify-center transition-transform transform hover:scale-105 relative border-t-4 border-[var(--primary-color)]";

        el.innerHTML = `
                <img src="${card.image}" alt="${card.title}"
                     class="h-24 w-24 object-contain mx-auto mb-3" />
                <h3 class="text-base font-bold mb-1 uppercase text-center text-[var(--text-color)]">
                  ${card.title}
                </h3>`;

        if (card.underConstruction) {
          el.classList.add("opacity-60", "cursor-not-allowed");
          el.innerHTML += `
                  <span class="absolute top-2 right-2 bg-yellow-400 text-xs font-bold
                               px-2 py-0.5 rounded">üöß Em constru√ß√£o</span>`;
          return container.appendChild(el);
        }

        el.classList.add("cursor-pointer");
        el.addEventListener("click", (event) => {
          trackAccess(card.title);
          if (card.popup && card.popupContent) {
            abrirModal(card.title, card.popupContent);
          } else if (card.link) {
            window.open(card.link, "_blank");
          } else if (card.moduleContent) {
            loadModuleContent(card.title, card.moduleContent);
          }
          event.stopPropagation();
        });

        container.appendChild(el);
      });
    }
    function abrirModal(titulo, conteudo) {
      document.getElementById("modalTitle").innerText = titulo;
      document.getElementById("modalContent").innerHTML = conteudo;
      document.getElementById("modal").classList.remove("hidden");
      document.getElementById("modal").classList.add("flex");
    }

    function fecharModal() {
      document.getElementById("modal").classList.add("hidden");
      document.getElementById("modal").classList.remove("flex");
    }

    function trackAccess(title) {
      let stored = JSON.parse(localStorage.getItem("accessStats")) || {};
      stored[title] = (stored[title] || 0) + 1;
      localStorage.setItem("accessStats", JSON.stringify(stored));
      renderMostAccessed();
    }

    function getAccessStatsFromCookies() {
      const cookie = document.cookie
        .split("; ")
        .find((row) => row.startsWith("accessStats="));
      if (!cookie) return {};
      try {
        return JSON.parse(decodeURIComponent(cookie.split("=")[1]));
      } catch (e) {
        return {};
      }
    }

    function saveAccessStatsToCookies(stats) {
      const json = encodeURIComponent(JSON.stringify(stats));
      document.cookie = `accessStats=${json}; path=/; max-age=604800`;
    }

    function trackAccess(title) {
      const stats = getAccessStatsFromCookies();
      stats[title] = (stats[title] || 0) + 1;
      saveAccessStatsToCookies(stats);
      renderMostAccessed();
    }

    function renderMostAccessed() {
      const list = document.getElementById("mostAccessedList");
      const stats = getAccessStatsFromCookies();
      const sorted = Object.entries(stats)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 5);

      list.innerHTML = "";

      if (sorted.length === 0) {
        list.innerHTML = "<li>Nenhuma plataforma acessada ainda !</li>";
        return;
      }

      sorted.forEach(([title, count]) => {
        const card = cardsData.find((c) => c.title === title);
        if (card) {
          const li = document.createElement("li");
          const a = document.createElement("a");
          a.href = "#";
          a.classList.add("text-[var(--text-color)]", "hover:underline");
          a.textContent = title;

          a.setAttribute("data-card-id", card.id);

          a.addEventListener("click", (event) => {
            event.preventDefault();

            trackAccess(card.title);

            document.getElementById("popupModal").classList.add("hidden");
            document.getElementById("popupModal").classList.remove("flex");

            if (card.popup && card.popupContent) {
              abrirModal(card.title, card.popupContent);
            } else if (card.link) {
              window.open(card.link, "_blank");
            } else if (card.moduleContent) {
              loadModuleContent(card.title, card.moduleContent);
            }
          });

          li.innerHTML = `üìå `;
          li.appendChild(a);

          const countSpan = document.createElement("span");
          countSpan.classList.add("text-xs", "text-gray-400", "ml-1");
          countSpan.textContent = `(${count}x)`;
          li.appendChild(countSpan);

          list.appendChild(li);
        }
      });
    }

    document.getElementById("openPopup").addEventListener("click", () => {
      renderMostAccessed();
      document.getElementById("popupModal").classList.remove("hidden");
      document.getElementById("popupModal").classList.add("flex");
    });

    document.getElementById("closePopup").addEventListener("click", () => {
      document.getElementById("popupModal").classList.add("hidden");
      document.getElementById("popupModal").classList.remove("flex");
    });

    document.getElementById("popupModal").addEventListener("click", (e) => {
      if (e.target === document.getElementById("popupModal")) {
        document.getElementById("popupModal").classList.add("hidden");
        document.getElementById("popupModal").classList.remove("flex");
      }
    });

    function toggleSidebar() {
      sidebar.classList.toggle("expanded");
      mainContent.classList.toggle("expanded");
      sidebar.querySelectorAll(".sidebar-text").forEach((span) => {
        span.classList.toggle("hidden");
      });
      sidebar.querySelectorAll(".sidebar-link img").forEach((img) => {
        img.classList.toggle("mr-3");
        img.classList.toggle("mr-0");
      });
    }

    function loadModuleContent(moduleTitle, contentHtml) {
      container.classList.add("hidden");
      moduleContentArea.classList.remove("hidden");

      moduleContentArea.innerHTML = contentHtml;

      trackAccess(moduleTitle);

      if (window.innerWidth < 1024 && sidebar.classList.contains("expanded")) {
        toggleSidebar();
      }

      document.querySelectorAll(".sidebar-link").forEach((link) => {
        link.classList.remove(
          "bg-[var(--hover-bg)]",
          "dark:bg-[var(--dark-hover-bg)]"
        );
        link.classList.remove("font-bold", "text-[var(--primary-color)]");
      });
      const clickedLink = document.querySelector(
        `.sidebar-link[data-module-id="${
          cardsData.find((card) => card.title === moduleTitle)?.id
        }"]`
      );
      if (clickedLink) {
        clickedLink.classList.add(
          "bg-[var(--hover-bg)]",
          "dark:bg-[var(--dark-hover-bg)]"
        );
        clickedLink.classList.add("font-bold", "text-[var(--primary-color)]");
      }
    }

    function showDashboard() {
      moduleContentArea.classList.add("hidden");
      container.classList.remove("hidden");
      trackAccess("Dashboard");

      document.querySelectorAll(".sidebar-link").forEach((link) => {
        link.classList.remove(
          "bg-[var(--hover-bg)]",
          "dark:bg-[var(--dark-hover-bg)]"
        );
        link.classList.remove("font-bold", "text-[var(--primary-color)]");
      });
      dashboardLink.classList.add(
        "bg-[var(--hover-bg)]",
        "dark:bg-[var(--dark-hover-bg)]"
      );
      dashboardLink.classList.add("font-bold", "text-[var(--primary-color)]");

      if (window.innerWidth < 1024 && sidebar.classList.contains("expanded")) {
        toggleSidebar();
      }
    }

    menuToggle.addEventListener("click", toggleSidebar);

    dashboardLink.addEventListener("click", (e) => {
      e.preventDefault();
      showDashboard();
    });

    const sidebarNav = sidebar.querySelector("nav");
    cardsData.forEach((card) => {
      const linkEl = document.createElement("a");
      linkEl.href = "#";
      linkEl.classList.add(
        "flex",
        "items-center",
        "p-4",
        "hover:bg-[var(--hover-bg)]",
        "dark:hover:bg-[var(--dark-hover-bg)]",
        "transition-colors",
        "duration-200",
        "sidebar-link"
      );
      linkEl.setAttribute("data-module-id", card.id);

      linkEl.innerHTML = `
                <img src="${card.image}" alt="${card.title}" class="h-6 w-6 mr-3">
                <span class="sidebar-text">${card.title}</span>
            `;

      linkEl.addEventListener("click", (e) => {
        e.preventDefault();
        loadModuleContent(card.title, card.moduleContent);
      });
      sidebarNav.appendChild(linkEl);
    });

    document.addEventListener("DOMContentLoaded", () => {
      renderCards();
      showDashboard();
      if (window.innerWidth >= 1024) {
        sidebar.classList.add("expanded");
        mainContent.classList.add("expanded");
      } else {
        sidebar.classList.remove("expanded");
        mainContent.classList.remove("expanded");
      }
    });

    tailwind.config = {
      darkMode: "class",
    };

    const publicToggle = document.getElementById("publicToggle");
    const publicSubmenu = document.getElementById("publicSubmenu");
    const chevron = document.getElementById("chevron");

    publicToggle.onclick = () => {
      publicSubmenu.classList.toggle("hidden");
      chevron.classList.toggle("rotate-180");
    };
  </script>
</html>
